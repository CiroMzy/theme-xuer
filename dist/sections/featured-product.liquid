
{%- liquid
  assign product = all_products[section.settings.product]
  assign min_aspect_ratio = 0.6
  assign current_variant = product.selected_or_first_available_variant
  assign featured_media = product.selected_or_first_available_variant.featured_media | default: product.featured_media

  for block in section.blocks
    if block.type == 'variant_picker' and block.settings.select_first_variant == false
      assign current_variant = product.selected_variant | default: false
      assign featured_media = product.featured_media
    endif
  endfor
-%}


<xuer-featured-product class="featured-product page_width custom-section">
  <div class="featured-product_slide">
    {% render 'product-slide', product: product, min_aspect_ratio: min_aspect_ratio %}
  </div>
  <div class="featured-product_blocks">
    {% for block in section.blocks %}
      {% case block.type %}
        {% when '@app' %}
          {% render block %}

        {% when 'title' %}
          <div class="featured-product_row" >
            {% if product != blank %}
              <h2 class="xuer-h1 title">{{ product.title | link_to: product.url }}</h2>
            {% else %}
              <h2 class="xuer-h1 title">{{ 'product.product_title' | t }}</h2>
            {% endif %}
          </div>

        {% when 'price' %}
          <div class="featured-product_row xuer-h4" >
            {% render 'price', product: product %}
          </div>

        {% when 'variant_picker' %}
          <div class="input-row" >
            {% if product != blank %}
              {% render 'variant-picker', section: section, product: product, block: block %}
            {% endif %}
          </div>

        {% when 'buy_buttons' %}
          <button class="xuer-button xuer-button_outline xuer-button_block featured-product_row">
            {{ 'product.add_to_cart' | t }}
          </button>

        {% when 'description' %}
          <div class="featured-product_row" >
            {{ product.description }}
          </div>

        {% when 'vendor' %}
          {%- liquid
            assign product_vendor_handle = product.vendor | handle
            if collections[product_vendor_handle].handle == product_vendor_handle
              assign vendor_url = collections[product_vendor_handle].url
            else
              assign vendor_url = product.vendor | url_for_vendor
            endif
          -%}
          <div class="vendor lightly-spaced-row" >
            {{ product.vendor | link_to: vendor_url }}
          </div>

        {% when 'sku' %}
          <div class="sku {% if current_variant and current_variant.sku == blank %}sku--no-sku{% endif %}" >
            {{- current_variant.sku -}}
          </div>



        {% when 'richtext' %}
          {% if block.settings.richtext != blank %}
            <div class="lightly-spaced-row" >
              <div class="rte cf">{{ block.settings.richtext }}</div>
            </div>
          {% endif %}




      {% endcase %}
    {% endfor %}
  </div>
  
</xuer-featured-product>
{% schema %}
{
  "name": "Featured product",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "product",
      "id": "product",
      "label": "Product"
    }
  ],
  "blocks": [
    {
      "type": "@app"
    },
    {
      "type": "title",
      "name": "Title",
      "limit": 1
    },
    {
      "type": "price",
      "name": "Price",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_tax_and_shipping",
          "label": "Show tax status and shipping policy link",
          "default": false
        }
      ]
    },
    {
      "type": "description",
      "name": "Description",
      "limit": 1
    },
    {
      "type": "vendor",
      "name": "Vendor",
      "limit": 1
    },
    {
      "type": "variant_picker",
      "name": "Variant picker",
      "limit": 1
    },
    {
      "type": "buy_buttons",
      "name": "Buy buttons",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_quantity_selector",
          "label": "Show quantity selector",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "enable_payment_button",
          "label": "Show dynamic checkout button",
          "default": true
        }
      ]
    },
    {
      "type": "richtext",
      "name": "Richtext",
      "settings": [
        {
          "type": "richtext",
          "id": "richtext",
          "label": "Rich text",
          "default": "<p>Rich text block</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Featured product",
      "blocks": [
        {
          "type": "title"
        },
        {
          "type": "price"
        },
        {
          "type": "variant_picker"
        },
        {
          "type": "buy_buttons"
        },
        {
          "type": "description"
        }
      ]
    }
  ]
}
{% endschema %}
