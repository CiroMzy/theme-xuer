{%- liquid
  if max_width
    assign width = width | at_most: max_width
  endif

  assign min_aspect_ratio = min_aspect_ratio | default: 0

  if aspect_ratio != blank
    assign local_aspect_ratio = aspect_ratio
  else
    assign local_aspect_ratio = image.aspect_ratio | at_least: min_aspect_ratio
  endif

  assign srcset_arr = srcset_arr | default: '180, 220, 300, 360, 460, 540, 720, 900, 1080, 1296, 1512, 1728, 2048'
  assign array_sizes = srcset_arr | remove: ' ' | split: ','
  
  assign src_list = ''
  
  for size in array_sizes
    assign size_str = size | append: 'w'
    assign image_url_str = image | image_url: width: size, crop: crop
    
    assign full_url = image_url_str | append: ' ' | append: size_str
    
    assign src_list = src_list | append: full_url
    if  forloop.last == false
      assign src_list = src_list | append: ','
    endif
  endfor

-%}

<div class="xuer-image-outer-wrapper" 
  {% if width != blank %}
    style="width: {{ width }}px;"  
  {% endif %}
>
  <div class="xuer-image-wrapper" 
    style="padding-top:{{ 1 | divided_by: local_aspect_ratio | times: 100 }}%"
    xuer-image
  >
    <img 
      {% if sizes_only %}
        {{ src_list }}
      {% else %}
        height="{{ image.height }}" width="{{ image.width }}" alt="{{ alt | default: image.alt | escape }}" src="{{ image | image_url: biggest_size_descriptor, crop: crop }}" srcset="{{ src_list }}"
      {% endif %}
      sizes="{{ sizes }}"
      loading="lazy" 
      class="xuer-image {{ img_class }} {% if cover %}cover{% endif %}"
    />
    <div class="loading xuer-loading">
      <svg focusable="false" width="50" height="50" class="icon icon--spinner   " viewBox="25 25 50 50">
        <circle cx="50" cy="50" r="20" fill="none" stroke="#282828" stroke-width="4"></circle>
      </svg>
    </div>
  </div>
</div>